# Mermaid to Image Changelog

## [AI Chat Integration Enhancement] - 2026-01-17
### Added
- **Inline Image Display in AI Chat**: Generated diagrams now automatically appear as inline images in Raycast AI conversations
- AI Tool now returns **ready-to-display markdown** that AI outputs directly without modification
- Permanent diagram storage for future reference and reuse
- **Automatic Cleanup of Old Temporary Files**: Manual mode now automatically cleans up temporary files older than 1 hour on each launch, preventing disk space accumulation

### Changed
- **New Storage Location**: AI-generated diagrams are now saved to `~/Downloads/MermaidDiagrams/` for easier access
- **Manual Mode Storage**: Manual mode uses `environment.supportPath` for temporary storage (separate from AI-generated diagrams)
- AI Tool now exclusively uses PNG format (optimized for AI chat display)
- Diagram files are no longer cleaned up after generation - they remain permanently accessible
- **Error Handling**: Tool now throws errors on failure instead of returning error message strings

### Improved
- **Fixed: Diagram not displaying issue** - Tool now returns complete markdown (`![Diagram](file://...)`) instead of just file path, preventing AI from forgetting to display the image
- **Fixed: Duplicate diagram generation** - Clear instructions prevent AI from calling tool multiple times for the same diagram
- Enhanced JSDoc description to explicitly instruct AI to output returned markdown exactly as-is
- Better user experience: diagrams appear both in chat AND are copied to clipboard
- Clearer documentation about where diagrams are stored and how they're managed
- Three-layer cleanup protection: immediate cleanup on component unmount, periodic cleanup on launch, and time-based cleanup for orphaned files

### Technical
- Added `pathToFileURL` to convert file paths to proper file:// URLs for markdown rendering
- Added `forceFormat` parameter to `generateMermaidDiagram()` function to distinguish AI vs manual mode
- Modified cleanup logic to preserve generated images while removing temporary files
- Storage path changed from internal support directory to user-accessible Downloads folder (AI mode only)
- Added `cleanupOldTempFiles()` function to prevent temporary file accumulation from crashes or incomplete cleanups
- Changed error handling from returning error strings to throwing Error objects

## [Add selected text support] - 2025-08-05
### Added
- **Selected text support**: Extension now prioritizes selected text over clipboard content when generating diagrams
- Users can now select Mermaid code in any application and run the extension to generate diagrams
- Added fallback mechanism: Selected text â†’ Clipboard content
- New "Generate from Clipboard Only" action (Cmd+Shift+V) for cases where text selection doesn't work properly
- Enhanced debugging logs to track input source and content validation

### Improved
- Better error messages indicating both input sources (selected text and clipboard)
- Added troubleshooting tips for applications that may not support text selection
- Toast notifications now show which source (selected/clipboard) is being used
- More robust input validation to handle edge cases with special characters and multi-line content

### Fixed
- Improved handling of complex Mermaid syntax (like sequence diagrams with special characters)
- Better empty input detection and user feedback

## [Add support for AI extension] - 2024-05-09
### Added
- Added a tool (`generateMermaidImageTool`) allowing users to ask Raycast AI to generate Mermaid diagrams (e.g., flowcharts, sequence diagrams) from natural language descriptions and automatically copy the resulting image to the clipboard.
- The new AI tool receives Mermaid syntax (often generated by the AI based on user prompts), utilizes the existing diagram generation engine (`@mermaid-js/mermaid-cli`), generates the image according to user preferences (PNG/SVG, theme), and copies the final image to the clipboard.
- Included detailed instructions and examples in `package.json` to guide Raycast AI on accurately interpreting user requests, generating Mermaid syntax, and correctly utilizing the new tool for image generation and copying.
- Registered the AI tool as a `no-view` command, enabling it to be invoked directly by Raycast AI in the background.
- **Added AI Evals:** Implemented evaluation test cases (`evals` in `package.json`) to verify AI interaction with the tool and provide users with example prompts for generating diagrams via AI.

## [Initial Version] - 2025-03-14
### Added
- Initial release of mermaid-to-image extension
- Automatic conversion of clipboard Mermaid code to images
- Support for PNG and SVG output formats
- Multiple theme options (Default, Forest, Dark, Neutral)
- Copy image directly to clipboard functionality
- Save image to custom directory
- Open image in default application
- Automatic cleanup of temporary files
- Detailed error handling and user feedback
- Memory optimization for complex diagrams

### Technical
- Integration with mermaid-cli for high-quality diagram rendering
- Automatic Node.js path detection
- Environment variable configuration for improved stability
- High-resolution image output with 2x scaling
